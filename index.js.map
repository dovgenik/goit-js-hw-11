{"version":3,"file":"index.js","sources":["../src/js/render-functions.js","../src/js/main.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nexport const mainVar = {\n  searchText: '',\n  carrentPage: 1,\n  pageLen: 20,\n  maxItems: 60,\n  direction: 'toBottom',\n};\nexport {\n  createGalleryItem,\n  deleteGalleryItem,\n  intersectionSet,\n  lightboxRefresh,\n  axiosCall,\n};\n\nlet lightbox;\n\nfunction axiosCall(text, pageN, pageL) {\n  if (pageN > 0 && pageL > 0) {\n    axios\n      .get('https://pixabay.com/api/', {\n        params: {\n          key: '49309273-01bbbdbc5dd72a8afdb67bc06',\n          q: text,\n          image_type: 'photo',\n          orientation: 'horizontal',\n          safesearch: true,\n          page: pageN,\n          per_page: pageL,\n        },\n      })\n      .then(response => {\n        createGalleryItem(response.data.hits);\n\n        lightboxRefresh();\n      })\n      .catch(error => {\n        console.log(error);\n      });\n  }\n}\n\nfunction deleteGalleryItem() {\n  document.querySelector('.gallery').outerHTML = `<ul class=\"gallery\"></ul>`;\n}\n\nfunction createGalleryItem(arrayImgs) {\n  if (arrayImgs.length < 1) {\n    iziToast.info({\n      message:\n        'Sorry, there are no images matching your search query. Please try again!',\n      close: true,\n      timeout: 5000,\n      position: 'topRight',\n    });\n  } else {\n    const fragment = document.createDocumentFragment();\n    const parentUl = document.querySelector('.gallery');\n\n    for (const element of arrayImgs) {\n      const li = document.createElement('li');\n      li.classList.add('gallery-item');\n\n      li.innerHTML = `<div class=\"gallery-div\">\n        <a class=\"gallery-link\" href=\"${element.largeImageURL}\">\n          <img class=\"gallery-image\" src=\"${element.webformatURL}\" alt=\"${element.tags}\">\n        </a>\n      </div>\n      <div class=\"img-footer\">\n        <div class=\"footer-item\"><p>Likes</p><p>${element.likes}</p></div>\n        <div class=\"footer-item\"><p>Views</p><p>${element.views}</p></div>\n        <div class=\"footer-item\"><p>Comments</p><p>${element.comments}</p></div>\n        <div class=\"footer-item\"><p>Downloads</p><p>${element.downloads}</p></div>\n      </div>`;\n\n      fragment.appendChild(li);\n    }\n    console.log(`Додавав ${mainVar.direction}`);\n\n    if (mainVar.direction === 'toBottom') {\n      console.log(`To bottom ${fragment}`);\n      parentUl.appendChild(fragment);\n\n      console.log(`Галерея after add = ${parentUl.children.length} елементів`);\n\n      while (parentUl.children.length > mainVar.maxItems) {\n        // видаляю зайві попереду галереї\n        parentUl.removeChild(parentUl.firstElementChild);\n      }\n      console.log(\n        `Gallery after del from bottom = ${parentUl.children.length} elements`\n      );\n    } else {\n      if (mainVar.direction === 'toTop') {\n        const scrollBefore = parentUl.scrollHeight;\n        parentUl.prepend(fragment); // add to top\n\n        const scrollAfter = parentUl.scrollHeight;\n        window.scrollBy(0, scrollAfter - scrollBefore);\n\n        while (parentUl.children.length > mainVar.maxItems) {\n          // видаляю зайві у кінці галереї\n          parentUl.removeChild(parentUl.lastElementChild);\n        }\n        console.log(\n          `Gallery after del from bottom = ${parentUl.children.length} elements`\n        );\n      }\n    }\n  }\n}\n\nfunction intersectionSet() {\n  let galleryLength = 0;\n  mainVar.runStarted = true;\n  const observerIntersection = new IntersectionObserver((entries, observer) => {\n    const situation = {\n      // для контролю положення маркерів div class=\"intersection-top marker-top\" і div class=\"intersection-bottom marker-bottom\"\n      markerTop: false,\n      markerBottom: false,\n    };\n    entries.forEach(entry => {\n      // для кожного контрол. елемента визначаю положення: тут, тобто isIntersecting, чи ні\n      if (entry.isIntersecting) {\n        console.log(entry.target.classList[1]);\n        if (entry.target.classList[1] === 'marker-top') {\n          situation.markerTop = true;\n        } else {\n          if (entry.target.classList[1] === 'marker-bottom') {\n            situation.markerBottom = true;\n          }\n        }\n      }\n    });\n    // визначаю куди проскролили галерею\n    if (situation.markerBottom && !situation.markerTop) {\n      // якщо дійшли до низу\n      mainVar.direction = 'toBottom'; // зовнішній маркер для інших учасників\n      axiosCall(mainVar.searchText, ++mainVar.carrentPage, mainVar.pageLen); // додаю записи знизу\n    } else {\n      if (!situation.markerBottom && situation.markerTop) {\n        // якщо дійшли до верху\n        mainVar.direction = 'toTop'; // зовнішній маркер для інших учасників\n        if (mainVar.carrentPage > 3) { // контроль номера сторінки, щоб не було 0, -1, і т.д.\n          axiosCall(mainVar.searchText, --mainVar.carrentPage - 2, mainVar.pageLen  ); // додаю записи зверху\n        }\n      }\n    }\n\n    console.log(situation);\n    console.log(`Page = ${mainVar.carrentPage} `);\n  });\n\n  observerIntersection.observe(document.querySelector(['.marker-top']));\n  observerIntersection.observe(document.querySelector(['.marker-bottom']));\n}\n\nfunction lightboxRefresh() {\n  // Оновлюємо SimpleLightbox після додавання зображень\n  if (lightbox) {\n    lightbox.refresh();\n  } else {\n    lightbox = new SimpleLightbox('.gallery a', {\n      captions: true,\n      captionsData: 'alt',\n      captionDelay: 250,\n      showCounter: true,\n      disableScroll: true,\n      navText: ['←', '→'],\n      closeText: '×',\n    });\n  }\n}\n\n//observerIntersection.observe(document.querySelector('.marker'));\n//observerIntersection.observe(document.querySelector('.marker12'));\n","import {mainVar, createGalleryItem, deleteGalleryItem, intersectionSet, lightboxRefresh,axiosCall, } from './render-functions.js';\n\n\n\n//*********   Start  ********************************************\n\nintersectionSet();\n\n\ndocument.querySelector('.form').addEventListener('submit', function (event) {\n  event.preventDefault();\n  deleteGalleryItem();\n  mainVar.searchText=event.target.elements['search-text'].value;\n  mainVar.direction = 'toBottom';\n  mainVar.carrentPage = 1;\n  axiosCall(mainVar.searchText, mainVar.carrentPage, mainVar.pageLen);\n});\n\n//***************************************************** \n\n"],"names":["mainVar","lightbox","axiosCall","text","pageN","pageL","axios","response","createGalleryItem","lightboxRefresh","error","deleteGalleryItem","arrayImgs","iziToast","fragment","parentUl","element","li","scrollBefore","scrollAfter","intersectionSet","observerIntersection","entries","observer","situation","entry","SimpleLightbox","event"],"mappings":"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"}